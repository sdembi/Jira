# Code Generated by Sidekick is for learning and experimentation purposes only.
name: Salesforce JIRA Integration 2

on:
  repository_dispatch:
    types: [jira-status-deployment-needed]

env:
  SALESFORCE_CLI_VERSION: latest
  NODE_VERSION: '18'

jobs:
  salesforce-integration:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: Install the SFDX CLI
        run: |
          npm install sfdx-cli --global

      - name: Setup JWT Key
        run: |
          echo "${{ secrets.SALESFORCE_JWT_KEY }}" > jwt.key
          chmod 600 jwt.key
#auth
      - name: Authenticate to Salesforce Org
        run: |
          sfdx force:auth:jwt:grant --username ${{ env.SALESFORCE_USERNAME }} --jwt-key-file ./jwt.key --clientid ${{ env.SALESFORCE_CLIENT_ID }} --instanceurl ${{ env.SALESFORCE_INSTANCE_URL }} --setdefaultusername
